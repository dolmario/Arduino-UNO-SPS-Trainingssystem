# LOGO! ‚Üí Arduino UNO/ESP32 SPS-Trainingssystem

[![License: MIT](https://img.shields.io/badge/License-MIT-blue.svg)](LICENSE)
[![Platform: Raspberry Pi](https://img.shields.io/badge/Platform-Raspberry%20Pi-red.svg)](https://www.raspberrypi.org/)
[![Arduino: UNO/ESP32](https://img.shields.io/badge/Arduino-UNO%2FESP32-00979D.svg)](https://www.arduino.cc/)

**Programmiere mit LOGO! Soft Comfort ‚Äì F√ºhre aus auf Arduino UNO oder ESP32 Hardware!**

Dieses Projekt erm√∂glicht Azubis, SPS-Programme in der vertrauten LOGO! Soft Comfort Umgebung zu entwickeln und auf kosteng√ºnstiger Arduino-Hardware (UNO oder ESP32) auszuf√ºhren. Der Arduino/ESP32 l√§uft **stand-alone** ‚Äì kein PC/Pi w√§hrend des Betriebs n√∂tig!

---

## üéØ Zielsetzung

- ‚úÖ **Bekannte Software**: Azubis nutzen LOGO! Soft Comfort (FUP/KOP)
- ‚úÖ **Billige Hardware**: Arduino UNO/ESP32 + Relais + Sensoren (~30‚Ç¨ statt 800‚Ç¨)
- ‚úÖ **Stand-Alone Betrieb**: Arduino/ESP32 arbeitet nach Upload autark
- ‚úÖ **Reale I/O**: Echte Relais, Temperatursensoren, PWM, Analog-Signale
- ‚úÖ **Einfach skalierbar**: 1 Raspberry Pi bedient 5+ Arbeitspl√§tze
- ‚úÖ **Multi-Board Support**: UNO (AVR) und ESP32 werden unterst√ºtzt

---

## üèóÔ∏è Architektur

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  LOGO! Soft Comfort     ‚îÇ  ‚Üê Azubi programmiert hier
‚îÇ  (Windows PC)           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ CSV/XML Export
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Raspberry Pi 3/4       ‚îÇ  ‚Üê Kompilier-Server
‚îÇ  ‚Ä¢ Parser (CSV/XML)     ‚îÇ
‚îÇ  ‚Ä¢ Code-Generator       ‚îÇ
‚îÇ  ‚Ä¢ arduino-cli          ‚îÇ
‚îÇ  ‚Ä¢ Support: UNO + ESP32 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
         ‚îÇ USB (nur zum Flashen)
         ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Arduino UNO / ESP32    ‚îÇ  ‚Üê Stand-Alone SPS
‚îÇ  ‚Ä¢ 4√ó Relais            ‚îÇ
‚îÇ  ‚Ä¢ 2√ó PWM (MOSFET)      ‚îÇ
‚îÇ  ‚Ä¢ Analog/Digital I/O   ‚îÇ
‚îÇ  ‚Ä¢ DS18B20 Temp-Sensor  ‚îÇ
‚îÇ  ‚Ä¢ Optional: OLED, etc. ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üöÄ Schnellstart (3 Minuten)

### 1. Installation auf Raspberry Pi

```bash
# Komplett-Installation (empfohlen)
curl -fsSL https://raw.githubusercontent.com/dolmario/Arduino-UNO-SPS-Trainingssystem/main/install.sh | bash

# Oder manuell
git clone https://github.com/dolmario/Arduino-UNO-SPS-Trainingssystem.git ~/logo2uno
cd ~/logo2uno
chmod +x install.sh
./install.sh
```

**Nach Installation:** Pi neu starten f√ºr Gruppenrechte (dialout)!

Der Installer richtet automatisch ein:
- Python 3 mit allen Dependencies (√ºber APT)
- arduino-cli mit AVR Core (Arduino UNO)
- arduino-cli mit ESP32 Core (optional)
- Serielle Rechte & UDEV-Regeln
- Desktop-Icon f√ºr GUI-Flash-Tool
- Projektordner `~/logo2uno/projects` und `~/logo2uno/generated`

### 2. Arduino/ESP32 anschlie√üen

- Arduino UNO oder ESP32 per USB an Raspberry Pi
- Relais-Board, Sensoren verdrahten (siehe [Hardware-Guide](docs/HARDWARE.md))

### 3. Erstes Projekt flashen

#### Kommandozeile (UNO):
```bash
cd ~/logo2uno
./build_and_flash.sh projects/test_blink.csv /dev/ttyUSB0 uno
```

#### Kommandozeile (ESP32):
```bash
cd ~/logo2uno
./build_and_flash.sh projects/test_blink.csv /dev/ttyUSB0 esp32
```

#### GUI (empfohlen f√ºr Azubis):
Desktop-Icon **"LOGO ‚Üí UNO/ESP32 Flash"** anklicken:
1. CSV/XML-Datei w√§hlen
2. Board w√§hlen (uno/esp32)
3. Port w√§hlen (automatisch erkannt)
4. Terminal zeigt Build & Upload

**Erfolg:** Arduino-LED blinkt oder ESP32 f√ºhrt Programm aus!

---

## üìñ Workflow f√ºr Azubis

### Schritt 1: In LOGO! Soft programmieren

1. LOGO! Soft Comfort V8.3 √∂ffnen
2. FUP-Editor: Programm erstellen
3. Simulieren & testen
4. **Datei ‚Üí Exportieren ‚Üí CSV** oder **XML speichern**

### Schritt 2: Auf Pi √ºbertragen

- **USB-Stick**: CSV/XML nach `~/logo2uno/projects/` kopieren
- **Netzlaufwerk**: `\\raspberrypi\logo2uno\projects\`
- **SCP/SFTP**: Direkter Upload via Netzwerk

### Schritt 3: Kompilieren & Flashen

**Option A ‚Äì GUI (einfachste Methode):**
1. Desktop-Icon anklicken
2. Projekt w√§hlen
3. Board w√§hlen (uno/esp32)
4. Port w√§hlen
5. Warten bis "‚úÖ Build & Flash abgeschlossen"

**Option B ‚Äì Kommandozeile:**
```bash
./build_and_flash.sh projects/mein_projekt.csv /dev/ttyUSB0 uno
# oder f√ºr ESP32:
./build_and_flash.sh projects/mein_projekt.csv /dev/ttyUSB0 esp32
```

**Das war's!** Arduino/ESP32 l√§uft jetzt stand-alone.

---

## üîß Hardware-Profil

Alle Pin-Zuordnungen in `hardware_profile.yaml`:

### Arduino UNO Standardbelegung

| LOGO! | Arduino | Hardware |
|-------|---------|----------|
| I1 | D9 | Taster 1 (Pull-Up) |
| I2 | D10 | Taster 2 (Pull-Up) |
| I3 | A2 | Sensor Digital |
| I4 | A3 | Sensor Digital |
| Q1 | D2 | Relais 1 (Heizung) |
| Q2 | D4 | Relais 2 (L√ºfter) |
| Q3 | D5 | Relais 3 (Licht) |
| Q4 | D7 | Relais 4 (Alarm) |
| AO1_PWM | D3 | MOSFET PWM 1 (0-255) |
| AO2_PWM | D6 | MOSFET PWM 2 (0-255) |
| AI1 | A0 | Analog Input CO‚ÇÇ (0-1023) |
| AI2 | A1 | Analog Input NOx (0-1023) |
| TEMP | D12 | DS18B20 (OneWire) |
| BUZZER | D8 | Piezo-Summer |

### ESP32 Hinweise

Bei ESP32 k√∂nnen die Pins flexibel in `hardware_profile.yaml` angepasst werden. Beachte:
- PWM auf jedem digitalen Pin m√∂glich
- ADC1 bevorzugt (ADC2 nicht mit WiFi nutzbar)
- Touch-Pins verf√ºgbar
- Mehr RAM & Flash als UNO

**Anpassbar!** Einfach `hardware_profile.yaml` editieren.

---

## üìö Unterst√ºtzte LOGO! Bausteine

### Logik
- ‚úÖ AND, OR, NOT, XOR, NAND, NOR

### Speicher & Flanken
- ‚úÖ SR-Flipflop, RS-Flipflop
- ‚úÖ R_TRIG (Positive Flanke), F_TRIG (Negative Flanke)

### Timer
- ‚úÖ TON (On-Delay Timer)
- ‚úÖ TOF (Off-Delay Timer)

### Z√§hler
- ‚úÖ CTU (Count Up)
- ‚úÖ CTD (Count Down)
- üöß CTUD (Up/Down) - in Arbeit

### Vergleicher
- ‚úÖ GT (>), LT (<), GE (‚â•), LE (‚â§), EQ (=), NE (‚â†)

### Mathematik
- ‚úÖ ADD (+), SUB (-), MUL (√ó), DIV (√∑)
- ‚úÖ MOVE (Zuweisung)

### Analog/PWM
- ‚úÖ PWM-Output (0-255)
- ‚úÖ Analog-Input (0-1023 UNO, 0-4095 ESP32)
- üöß PID-Regler - geplant

### Sensoren & Peripherie
- ‚úÖ DS18B20 Temperatursensor (OneWire)
- ‚úÖ MQ-x Gassensoren (analog)
- ‚úÖ 7-Segment BCD-Ausgabe
- ‚úÖ KY-040 Rotary Encoder
- üöß I2C OLED Display - in Arbeit
- üöß INA219 Strom/Spannung - geplant

---

## üõ†Ô∏è Projektstruktur

```
logo2uno/
‚îú‚îÄ‚îÄ install.sh                  # Ein-Klick-Installation
‚îú‚îÄ‚îÄ hardware_profile.yaml       # Pin-Mapping & Kalibrierung
‚îÇ
‚îú‚îÄ‚îÄ parser_logo.py              # CSV/XML ‚Üí Python Bl√∂cke
‚îú‚îÄ‚îÄ generator_arduino.py        # Python Bl√∂cke ‚Üí .ino Sketch
‚îú‚îÄ‚îÄ build_and_flash.sh          # Build & Upload Pipeline
‚îú‚îÄ‚îÄ flash_gui.sh                # Zenity GUI f√ºr Azubis
‚îÇ
‚îú‚îÄ‚îÄ projects/                   # LOGO! CSV/XML Projekte
‚îÇ   ‚îú‚îÄ‚îÄ test_blink.csv
‚îÇ   ‚îú‚îÄ‚îÄ heizung_regler.xml
‚îÇ   ‚îî‚îÄ‚îÄ ...
‚îÇ
‚îú‚îÄ‚îÄ generated/                  # Build-Artefakte
‚îÇ   ‚îú‚îÄ‚îÄ projekt_20250119-143022/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projekt.ino
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ projekt.ino.hex
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ build.log
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ meta.yaml
‚îÇ   ‚îî‚îÄ‚îÄ current -> projekt_.../ # Symlink zum letzten Build
‚îÇ
‚îú‚îÄ‚îÄ examples/                   # Beispielprojekte
‚îú‚îÄ‚îÄ docs/                       # Dokumentation
‚îÇ   ‚îú‚îÄ‚îÄ HARDWARE.md
‚îÇ   ‚îî‚îÄ‚îÄ TRAINING_GUIDE.md
‚îÇ
‚îî‚îÄ‚îÄ template.ino                # Arduino-Sketch-Vorlage
```

---

## üéì Trainingsszenarien

### 1. Heizungssteuerung
- Temperatursensor DS18B20
- Zweipunkt-Regler (TON/TOF)
- PWM-MOSFET f√ºr stufenlose Leistung
- Notabschaltung bei √úbertemperatur

### 2. L√ºftungsanlage
- CO‚ÇÇ-Sensor (MQ-135)
- 3-Stufen-Steuerung via Relais
- Zeitverz√∂gerung beim Nachlauf
- St√∂rungsanzeige (Buzzer + LED)

### 3. Ampelsteuerung
- 3√ó Relais (Rot/Gelb/Gr√ºn)
- Timer-Sequenzen
- Taster f√ºr Fu√üg√§nger-Anforderung
- Nacht-Modus (Gelb-Blinken)

### 4. F√∂rderband-Simulation
- 2√ó Motoren (PWM-Drehzahlregelung)
- Encoder f√ºr Position
- NOT-AUS mit sicherem Halt
- Z√§hler f√ºr Werkst√ºcke

---

## üîç Fehlersuche

### Port nicht gefunden
```bash
# Alle seriellen Ports auflisten
ls -l /dev/ttyUSB* /dev/ttyACM*

# arduino-cli Board-Liste
/usr/local/bin/arduino-cli board list

# Rechte pr√ºfen
groups  # sollte "dialout" enthalten
```

### ESP32 Upload-Fehler
- **Boot-Taste** gedr√ºckt halten w√§hrend Upload
- USB-Kabel direkt an Pi (kein Hub)
- Anderes USB-Kabel testen
- CH340-Treiber pr√ºfen (sollte via install.sh vorhanden sein)

### Kompilierung schl√§gt fehl
```bash
# Parser-Test
python3 parser_logo.py projects/mein_projekt.csv

# Generator-Test
python3 generator_arduino.py projects/mein_projekt.csv > test.ino

# Logs pr√ºfen
cat generated/current/build.log
```

### Relais schaltet falsch herum
In `hardware_profile.yaml`:
```yaml
flags:
  relays_active_low: true  # LOW = EIN (h√§ufigster Fall)
  # oder
  relays_active_low: false # HIGH = EIN
```

---

## üîê Sicherheit & Best Practices

### Elektrische Sicherheit
- ‚ö†Ô∏è **Nur SELV-Spannungen** (‚â§ 48V DC / ‚â§ 24V AC) f√ºr Azubi-Training!
- **Keine 230V-Lasten** ohne Elektrofachkraft
- Relais-Last max. 10A @ 230V AC (siehe Datenblatt)
- Schutzleiter bei Metallgeh√§usen

### Code-Qualit√§t
- Immer in LOGO! Soft simulieren vor dem Flash
- Hardware-Tests mit LED/Summer statt teuren Aktoren
- Versionierung via Git empfohlen

### Datensicherung
Automatisches Backup via Cron (siehe `setup_autostart.sh`):
```bash
# Manuelles Backup
cd ~/logo2uno
tar czf backup_$(date +%Y%m%d).tar.gz projects/ hardware_profile.yaml
```

---

## üåê Netzwerk-Features

### Samba-Share (optional)
Windows-Netzlaufwerk f√ºr einfachen Dateizugriff:
```bash
# In install.sh aktivieren:
ENABLE_SAMBA_SHARE=true ./install.sh

# Windows-Zugriff:
\\raspberrypi\logo2uno_generated
```

### Webinterface (geplant)
- Upload via Browser
- Live-Monitoring der Arduinos
- Online-Editor f√ºr `hardware_profile.yaml`

---

## üß™ Entwicklung & Beitragen

### Neuen LOGO!-Block hinzuf√ºgen

1. **Parser erweitern** (`parser_logo.py`):
   ```python
   SUPPORTED_TYPES.add("MEIN_BLOCK")
   ```

2. **Generator erg√§nzen** (`generator_arduino.py`):
   ```python
   elif t == "MEIN_BLOCK":
       # Code-Generierung hier
   ```

3. **Testen**:
   ```bash
   ./build_and_flash.sh examples/test_mein_block.csv
   ```

### Pull Requests willkommen!
- Neue Bausteine (PID, Hysterese, etc.)
- Sensor-Bibliotheken (BME280, INA219, etc.)
- ESP32-spezifische Features (WiFi, Bluetooth)
- Dokumentation & Tutorials

---

## üì¶ Abh√§ngigkeiten

### Raspberry Pi
- Raspberry Pi OS (Bullseye oder neuer)
- Python 3.9+
- arduino-cli 0.35+

### Arduino Libraries (automatisch installiert)
- OneWire (DS18B20)
- DallasTemperature
- Encoder (optional)

### Python Packages (via APT)
- python3-yaml
- python3-serial
- python3-rpi.gpio

---

## üìù Lizenz

MIT License - siehe [LICENSE](LICENSE)

**Frei nutzbar f√ºr Ausbildung, Lehre und kommerzielle Zwecke!**

---

## üôè Danksagungen

- Siemens LOGO! Soft Comfort f√ºr die intuitive Programmierumgebung
- Arduino & ESP32 Community
- Alle Ausbilder & Azubis, die Feedback geben

---

## üìû Support

- **Issues**: [GitHub Issues](https://github.com/dolmario/Arduino-UNO-SPS-Trainingssystem/issues)
- **Diskussionen**: [GitHub Discussions](https://github.com/dolmario/Arduino-UNO-SPS-Trainingssystem/discussions)
- **Wiki**: [Projekt-Wiki](https://github.com/dolmario/Arduino-UNO-SPS-Trainingssystem/wiki)

**Viel Erfolg beim Training! üéìüîß**
